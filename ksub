#!/bin/bash

usage() { echo "Usage: $0 [-f <inputfile>] -e <executable>" 1>&2; exit 1; }

gendirs()
{
    export count=$(head -1 .counter 2>/dev/null)
    if [ "_$count" = "_" ]; then
        echo "reset requried"
	exit 1
    fi

    expr $count + 1 > .counter
    mkdir -p dirtodo/run"$count"/infiles
    mkdir -p dirtodo/run"$count"/cmd
}

while getopts ":f:e:" o; do
case "${o}" in
  f)
      infile=${OPTARG}
      ;;
  e)
      exec=${OPTARG}
      ;;
  *)
      usage
      ;;
esac
done

gendirs

cd dirtodo/run$count/cmd

ln -s $exec $(basename $exec)

cd -
